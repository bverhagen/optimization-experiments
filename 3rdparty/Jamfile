project 3rdparty    :
                    ;

import notfile ;

rule git-submodule ( name : extra-sources * : requirements * )
{
    git-submodule-commit $(name).commit ;
    make $(name) : $(name).commit : @download-submodule ;
}

actions download-submodule
{
    "3rdparty/getSubmodule.sh" "$(>)" "$(<)" 
}

rule git-submodule-commit ( name : extra-sources * : requirements * )
{
    notfile $(name) : @submodulecommit ;
}

actions submodulecommit
{
     3rdparty/getSubmoduleCommit.sh "$(<)"
}






git-submodule benchmark.submodule ;
make benchmark/build/src/libbenchmark.a : benchmark.submodule : @buildBenchmark
                                        : <link>static
                                        ;

actions buildBenchmark
{
    echo "Building lib benchmark..."
    mkdir -p 3rdparty/benchmark/build
    cd 3rdparty/benchmark/build
    cmake -DCMAKE_BUILD_TYPE=release -DBENCHMARK_ENABLE_TESTING=OFF -DBENCHMARK_ENABLE_LTO=OFF ..
    make -j
    cd ../../..
    cp 3rdparty/benchmark/build/src/libbenchmark.a $(<)
} 

alias benchmark-lib : benchmark/build/src/libbenchmark.a ;
